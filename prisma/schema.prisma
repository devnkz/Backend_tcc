generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id         String  @id @default(uuid())
  name       String
  apelido    String
  fotoPerfil String?
  email      String  @unique
  senha      String

  fkIdTipoUsuario String
  tipoUsuario     TipoUsuario @relation(fields: [fkIdTipoUsuario], references: [id])

  fkIdCurso String
  curso     Curso  @relation(fields: [fkIdCurso], references: [id]) // obrigatÃ³rio

  createdAt     DateTime   @default(now())
  pergunta      Pergunta[]
  respostas     Resposta[]
  grupos        Membro[] // ðŸ‘ˆ relaÃ§Ã£o N:N via tabela Membro
  gruposCriados Grupo[]    @relation("GrupoCriador") // ðŸ‘ˆ grupos que o user criou
}

model TipoUsuario {
  id    String @id @default(uuid())
  nome  String
  users User[]
}

model Curso {
  id          String       @id @default(uuid())
  nome        String
  users       User[]
  componentes Componente[]
}

model Pergunta {
  id             String     @id @default(uuid())
  conteudo       String
  userId         String
  user           User       @relation(fields: [userId], references: [id])
  fkIdComponente String
  componente     Componente @relation(fields: [fkIdComponente], references: [id])
  createdAt      DateTime   @default(now())
  respostas      Resposta[]
}

model Resposta {
  id         String   @id @default(uuid())
  conteudo   String
  userId     String
  perguntaId String
  user       User     @relation(fields: [userId], references: [id])
  pergunta   Pergunta @relation(fields: [perguntaId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
}

model Grupo {
  id             String     @id @default(uuid())
  nomeGrupo      String
  fkIdComponente String
  createdById    String
  createdBy      User       @relation("GrupoCriador", fields: [createdById], references: [id])
  membros        Membro[] // ðŸ‘ˆ membros do grupo
  componente     Componente @relation(fields: [fkIdComponente], references: [id])
}

model Membro {
  id      String @id @default(uuid())
  userId  String
  grupoId String
  user    User   @relation(fields: [userId], references: [id])
  grupo   Grupo  @relation(fields: [grupoId], references: [id])

  @@unique([userId, grupoId]) // cada user sÃ³ pode estar uma vez no grupo
}

model Componente {
  id        String     @id @default(uuid())
  nome      String
  fkIdCurso String
  curso     Curso      @relation(fields: [fkIdCurso], references: [id])
  grupos    Grupo[]
  perguntas Pergunta[]
}
