generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuarios {
  id_usuario            String  @id @default(uuid())
  nome_usuario          String
  apelido_usuario       String
  foto_perfil           String?
  email_usuario         String  @unique
  senha_usuario         String
  credibilidade_usuario Int

  fkIdTipoUsuario String
  tipoUsuario     TipoUsuario @relation(fields: [fkIdTipoUsuario], references: [id_tipousuario])

  dataCriacao_usuario DateTime      @default(now())
  pergunta            Pergunta[]
  respostas           Resposta[]
  grupos              Membro[]
  gruposCriados       Grupo[]       @relation("GrupoCriador")
  Curso               Curso?        @relation(fields: [cursoId_curso], references: [id_curso])
  cursoId_curso       String?
  Mensagem            Mensagem[]
  Denuncias           Denuncias[]
  Penalidades         Penalidades[]
}

model TipoUsuario {
  id_tipousuario   String     @id @default(uuid())
  nome_tipousuario String
  users            Usuarios[]
}

model Curso {
  id_curso    String       @id @default(uuid())
  nome_curso  String
  componentes Componente[]
  Usuarios    Usuarios[]
  Pergunta    Pergunta[]
}

model Pergunta {
  id_pergunta          String     @id @default(uuid())
  pergunta             String
  fkId_usuario         String
  usuario              Usuarios   @relation(fields: [fkId_usuario], references: [id_usuario])
  fkId_componente      String
  componente           Componente @relation(fields: [fkId_componente], references: [id_componente])
  dataCriacao_pergunta DateTime   @default(now())
  fkId_curso           String
  curso                Curso      @relation(fields: [fkId_curso], references: [id_curso])
  respostas            Resposta[]
}

model Resposta {
  id_resposta          String   @id @default(uuid())
  resposta             String
  fkId_usuario         String
  fkId_pergunta        String
  usuario              Usuarios @relation(fields: [fkId_usuario], references: [id_usuario])
  pergunta             Pergunta @relation(fields: [fkId_pergunta], references: [id_pergunta], onDelete: Cascade)
  dataCriacao_resposta DateTime @default(now())
}

model Grupo {
  id_grupo     String     @id @default(uuid())
  nome_grupo   String
  fkId_usuario String
  usuario      Usuarios   @relation("GrupoCriador", fields: [fkId_usuario], references: [id_usuario])
  membros      Membro[]
  mensagens    Mensagem[]
}

model Membro {
  id_membro    String   @id @default(uuid())
  fkId_usuario String
  fkId_grupo   String
  usuario      Usuarios @relation(fields: [fkId_usuario], references: [id_usuario])
  grupo        Grupo    @relation(fields: [fkId_grupo], references: [id_grupo])

  @@unique([fkId_usuario, fkId_grupo])
}

model Mensagem {
  id_mensagem          String   @id @default(uuid())
  mensagem             String
  fkId_usuario         String
  fkId_grupo           String
  dataCriacao_Mensagem DateTime @default(now())

  usuario Usuarios @relation(fields: [fkId_usuario], references: [id_usuario])
  grupo   Grupo    @relation(fields: [fkId_grupo], references: [id_grupo])
}

model Componente {
  id_componente   String     @id @default(uuid())
  nome_componente String
  fkId_curso      String
  curso           Curso      @relation(fields: [fkId_curso], references: [id_curso])
  perguntas       Pergunta[]
}

model Denuncias {
  id_denuncia              String   @id @default(uuid())
  fkId_usuario             String
  fkId_conteudo_denunciado String
  descricao                String
  nivel_denuncia           Int
  status                   String   @default("pendente")
  resultado                String
  dataCriacao_denuncia     DateTime @default(now())

  usuario    Usuarios     @relation(fields: [fkId_usuario], references: [id_usuario])
  penalidade Penalidades? @relation("DenunciasToPenalidades")
}

model Penalidades {
  id_penalidade          String   @id @default(uuid())
  fkId_usuario           String
  fkId_denuncia          String   @unique
  banimento              String?
  perder_credibilidade   String
  descricao              String
  ativa                  Boolean  @default(true)
  dataCriacao_penalidade DateTime @default(now())

  usuario  Usuarios  @relation(fields: [fkId_usuario], references: [id_usuario])
  denuncia Denuncias @relation("DenunciasToPenalidades", fields: [fkId_denuncia], references: [id_denuncia])
}
